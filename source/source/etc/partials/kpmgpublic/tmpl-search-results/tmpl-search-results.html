<section class="module-tmpl-search-results">

    <div class="inner-container">
        <div class="row">
            <div class="row-same-height row-full-height">
                {{ include "searchresults" resourceType="/apps/kpmgpublic/components/search/search-results"}}
            </div>

        </div>
    </div>

</section>

<script type="text/javascript">
    searchAnalyticFunc = function(operation) {
        function closest(elem, selector) {
            var matchesSelector = elem.matches || elem.webkitMatchesSelector || elem.mozMatchesSelector || elem.msMatchesSelector;
            while (elem) {
                if (matchesSelector.bind(elem)(selector)) {
                    return elem;
                } else {
                    elem = elem.parentElement;
                }
            }
            return false;
        }

        function getParameterByName(name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                results = regex.exec(location.search);
            return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        }
        var totalResultsDOM = document.getElementById('totalResults'),
            searchWord = document.getElementById('search').value;
            if (searchWord === "") {
                searchWord = getParameterByName("keyword");
            }

        if (totalResultsDOM !== null) {

            var outResults = totalResultsDOM.innerHTML,
                isResultFound = false,
                isSuggest = false,
                facetBox = document.getElementsByClassName('facetBox'),
                page = parseInt(outResults / 9),
                types = '',
                attributes = '',
                prev = '';

            if (outResults) {
                isResultFound = true;
            }

            if (!parseInt(document.getElementById('totalResults').innerHTML)) {
                isSuggest = true;
            }

            if ((outResults % 9) !== 0) {
                page = page + 1;
            }

            for (var i = 0; i < facetBox.length; i++) {
                var e = facetBox[i];
                if (e.checked) {
                    if ((e.value).indexOf('All') === -1) {
                        var comma = types.length === 0 ? '' : ',',
                            pipe = attributes.length === 0 ? '' : '|',
                            comm = attributes.length === 0 ? '' : ',',
                            closestFacets = closest(e, '.facetFilters'),
                            amp = closestFacets.querySelector('span.facetTitle').innerText,
                            amp = amp.replace('filter by:','');

                        if (types.indexOf(amp) === -1) {
                            types += (comma + amp);
                        }
                        if (prev === amp) {
                            attributes += (pipe + e.value);
                        } else {
                            attributes += (comm + e.value);
                        }
                        prev = amp;
                    }
                }
            }
            if (types !== '') {
                types = types.trim();
            }
            try {
                digitalData.page.searchInfo = {
                    typeList: types,
                    attributeList: attributes,
                    termList: searchWord,
                    numResults: outResults,
                    results: isResultFound,
                    suggestion: isSuggest,
                    pageNum: page,
					internalSearchEngine:"Search and Promote"
                };
                if (typeof operation === "undefined" || operation === "") {
                   /* s.trackEvent({
                        "searchTerm1": searchWord,
                        "searchTerm2": searchWord,
                        "searchType1": "Search and Promote",
                        "searchType2": "Search and Promote"
                    }, "Internal Search");*/
                    _satellite.track("searchResultsLoad");
                }
            } catch (err) {
                //console.log('Tracking disabled hence "S" object is undefined...');
            }
        } else {
            if (document.getElementsByClassName('didYouMean').length !== 0) {
                try {
                    digitalData.page.searchInfo = {
                        termList: searchWord,
                        numResults: "",
                        results: false,
                        suggestion: true,
                        pageNum: "",
						internalSearchEngine:"SmartLogic"
                    };
                    /*s.trackEvent({
                        "searchTerm1": searchWord,
                        "searchTerm2": searchWord,
                        "searchType1": "SmartLogic",
                        "searchType2": "SmartLogic"
                    }, "Internal Search");*/
                    _satellite.track("searchResultsLoad");
                } catch (err) {
                    //console.log('Tracking disabled hence "S" object is undefined...');
                }
            } else {
                try {
                    digitalData.page.searchInfo = {
                        termList: searchWord,
                        numResults: "",
                        results: false,
                        suggestion: false,
                        pageNum: "",
						internalSearchEngine:"SmartLogic"
                    };
                  /*s.trackEvent({
                        "searchTerm1": searchWord,
                        "searchTerm2": searchWord,
                        "searchType1": "SmartLogic",
                        "searchType2": "SmartLogic"
                    }, "Internal Search");*/
                    _satellite.track("searchResultsLoad");

                } catch (err) {
                    //console.log('Tracking disabled hence "S" object is undefined...');
                }
            }
        }
    };
</script>
