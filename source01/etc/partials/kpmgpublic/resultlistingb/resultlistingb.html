<div class="resultListingCQModel" id="CQModel" data-CQModal='
   {"i18nModel":{"moreButtonCopy":"{{i18n hbs.resultListing.moreButtonCopy}}","clearAllCopy":"{{i18n hbs.resultListing.clearAllCopy}}","facetMoreButtonCopy":"{{i18n hbs.resultListing.facetMoreButtonCopy}}","backButtonCopy":"{{i18n hbs.resultListing.backButtonCopy}}","searchBarDefaultCopy":"{{i18n hbs.resultListing.kpmg.search.searchBarDefaultCopy}}","title":"{{i18n hbs.resultListing.title}}","quickViewContactLinkCopy":"{{i18n hbs.resultListing.quickViewContactLinkCopy}}","quickViewDownloadCopy":"{{i18n hbs.resultListing.quickViewDownloadCopy}}","radioButtonOne":"{{i18n hbs.resultListing.radioButtonOne}}","radioButtonTwo":"{{i18n hbs.resultListing.radioButtonTwo}}","broadenSearchCopy":"{{i18n hbs.resultListing.broadenSearchCopy}}","viewIconsLabel": "{{i18n hbs.resultListing.viewIconsLabel}}","noResultsCopy":"{{i18n hbs.resultListing.noResultsCopy}}","noResultsCopyLineTwo":"{{i18n hbs.resultListing.noResultsCopyLineTwo}}","noResultsCopyLineThree":"{{i18n hbs.resultListing.noResultsCopyLineThree}}","noResultsCopyLineFour":"{{i18n hbs.resultListing.noResultsCopyLineFour}}","noResultsCopyLineFive":"{{i18n hbs.resultListing.noResultsCopyLineFive}}","noResultsCopyLineSix":"{{i18n hbs.resultListing.noResultsCopyLineSix}}","searchNPromoteUrl":"{{hbs.resultListing.searchNPromoteUrl}}","baseUrl":"{{hbs.resultListing.baseUrl}}","tab0": "{{i18n hbs.resultListing.tab0}}","tab1":"{{i18n hbs.resultListing.tab1}}","tab2":"{{i18n hbs.resultListing.tab2}}","tab3":"{{i18n hbs.resultListing.tab3}}","quickViewInTile":"{{i18n hbs.resultListing.quickViewInTile}}","resultsLineOne":"{{i18n hbs.resultListing.noResultsCopyLineOne}}","noResultsCopyLineTwoPartOne":"{{i18n hbs.resultListing.noResultsCopyLineTwoPartOne}}","noResultsCopyLineTwoPartTwo":"{{i18n hbs.resultListing.noResultsCopyLineTwoPartTwo}}","noResultsLineThree":"{{i18n hbs.resultListing.noResultsLineThree}}","contactFormLinkCopy":"{{i18n hbs.resultListing.contactFormLinkCopy}}","lessButtonCopy":"{{i18n hbs.resultListing.lessButtonCopy}}","shareLabel":"{{i18n hbs.resultListing.shareLabel}}",
    "KPMG_Filter_Year" :"{{i18n hbs.resultListing.KPMG_Filter_Year}}",
        "KPMG_Event_Location": "{{i18n hbs.resultListing.KPMG_Event_Location}}",
        "KPMG_Topic_Path": "{{i18n hbs.resultListing.KPMG_Topic_Path}}",
        "KPMG_Cont_Type_Path": "{{i18n hbs.resultListing.KPMG_Cont_Type_Path}}",
        "KPMG_Geo_Rel_Path": "{{i18n hbs.resultListing.KPMG_Geo_Rel_Path}}",
        "KPMG_Market_Path": "{{i18n hbs.resultListing.KPMG_Market_Path}}",
        "KPMG_Ind_Path_Loc": "{{i18n hbs.resultListing.KPMG_Ind_Path_Loc}}",
        "KPMG_Ind_Path": "{{i18n hbs.resultListing.KPMG_Ind_Path}}",
        "KPMG_Service_Pth_Loc": "{{i18n hbs.resultListing.KPMG_Service_Pth_Loc}}",
        "KPMG_Service_Path": "{{i18n hbs.resultListing.KPMG_Service_Path}}",
        "KPMG_Cont_Mem_Firm": "{{i18n hbs.resultListing.KPMG_Cont_Mem_Firm}}",
        "didYouMean":"{{i18n hbs.resultListing.didYouMeanCopy}}",
        "resultsForCopy":"{{i18n hbs.resultListing.resultsForCopy}}",
        "ALL_TEXT":"{{i18n hbs.resultListing.allInFacets}}",
        "sortingViewed":"{{i18n "kpmg.resultslistingnotabs.mostviewed"}}",
        "sortingPopular":"{{i18n "kpmg.resultslistingnotabs.mostpopular"}}",
        "upcomingEvent":"{{i18n hbs.resultListing.upcomingEvent}}",
        "eventsThisMonth":"{{i18n hbs.resultListing.eventsThisMonth}}",
        "sortingDate":"{{i18n "kpmg.resultslistingnotabs.sortbydate"}}"
     },"smartLogicUrl":"{{hbs.resultListing.smartLogicUrl}}","globalSearchUrl":"{{hbs.resultListing.searchNPromoteUrl}}","globalSearchParam":"{{hbs.resultListing.globalSearchParam}}","localSearchParam":"{{hbs.resultListing.localSearchParam}}","onlyGridViewFlag":"{{hbs.resultListing.onlyGridViewFlag}}","showTime":"{{hbs.resultListing.showTime}}","peopleContactFormLink":"{{hbs.resultListing.peopleContactFormLink}}","upcomingEventsParam":"{{hbs.resultListing.upcomingEventsParam}}","thisMonthParam":"{{hbs.resultListing.eventsThisMonthParam}}"}'>
</div>
<section class="module-resultlistingb component" data-result-url="{{hbs.resultListing.searchNPromoteUrl}}">
<div class="overlay">&nbsp;</div>
   <div class="row no-border">
      <div class="row facets-results-container" >
          <div class="facets-container">
             <div class="facetsContent">
                 <div class="wrapper-facet">
                     <div class="pull-left filterOpt">
                        <div class="facetsTitle">
                            <span href="javascript:void(0)" class="cancelFilter pull-left  icon-close"></span>
                            <h3 class="secondary-head">{{i18n hbs.resultListing.title}}</h3>
                        </div>
                     </div>
                 </div>
                <div class="facetsGroup">
                   <ul class="resp-tabs-list">
                      <li class="facetFilters KPMG_Service_Path KPMG_Service_Pth_Loc no-results">
                          <button class="custom-select facet-head" aria-expanded="false">
                              <span class="sr-only">Filter by</span>
                              <span class="facetTitle">{{i18n hbs.resultListing.KPMG_Service_Path}}</span>
                          </button>
                          <div class="facet-list"></div>
                      </li>
                      <li class="facetFilters KPMG_Ind_Path KPMG_Ind_Path_Loc no-results">
                          <button class="custom-select facet-head" aria-expanded="false">
                              <span class="sr-only">Filter by</span>
                              <span class="facetTitle">{{i18n hbs.resultListing.KPMG_Ind_Path}}</span>
                          </button>
                          <div class="facet-list"></div>
                      </li>
                      <li class="facetFilters KPMG_Topic_Path no-results">
                          <button class="custom-select facet-head" aria-expanded="false">
                              <span class="sr-only">Filter by</span>
                              <span class="facetTitle">{{i18n hbs.resultListing.KPMG_Topic_Path}}</span>
                          </button>
                          <div class="facet-list"></div>
                      </li>
                      <li class="facetFilters KPMG_Geo_Rel_Path no-results">
                          <button class="custom-select facet-head" aria-expanded="false">
                              <span class="sr-only">Filter by</span>
                              <span class="facetTitle">{{i18n hbs.resultListing.KPMG_Geo_Rel_Path}}</span>
                          </button>
                          <div class="facet-list"></div>
                      </li>
                      <!--  upcoming dropdown for Events Landing page -->
                      {{#if hbs.resultListing.eventLandingTemplate}}
                          <li class="facetFilters upcoming-dropdown no-results">
                              <button class="custom-select facet-head" aria-expanded="false">
                                  <span class="sr-only">Filter by</span>
                                  <span class="facetTitle">{{i18n "kpmg.resultslistingnotabs.latest"}}</span>
                              </button>
                              <div class="facet-list"></div>
                          </li>
                      {{/if}}
                       <!--  latest dropdown for Insights & Press Releases -->
                       {{#if hbs.resultListing.latestDropDown }}
                          <li class="facetFilters latest-dropdown no-results">
                              <button class="custom-select facet-head" aria-expanded="false">
                                  <span class="sr-only">Filter by</span>
                                  <span class="facetTitle">{{i18n "kpmg.resultslistingnotabs.latest"}}</span>
                              </button>
                              <div class="facet-list"></div>
                          </li>
                      {{/if}}
                      <li class="facetFilters KPMG_Filter_Year KPMG_FILTER_YEAR no-results">
                          <button class="custom-select facet-head" aria-expanded="false">
                              <span class="sr-only">Filter by</span>
                              <span class="facetTitle">{{i18n "kpmg.resultslistingnotabs.year"}}</span>
                          </button>
                          <div class="facet-list"></div>
                      </li>
                   </ul>
                </div>
             </div>
          </div>
          <div class="col-md-12 resultsListingcontainer">
             <div class="resultslistingContent ">
                <div class="resultsContainer">
                   <div class="sortResults">
                   </div>
                    <div class="upcomingResults">
                        <div class="noDataFound">
                            <p class="upcoming-error upcoming-events visually-hidden">{{hbs.resultListing.upcomingEventsErrorMessage}}</p>
                            <p class="upcoming-error this-month visually-hidden">{{hbs.resultListing.thisMonthErrorMessage}}</p>
                        </div>
                    </div>
                   <div class="resultsSet">
                      <div class="resultsListContainer">
                         <div class="row row-same-height row-full-height resultSet"></div>
                         <div class="loadMore visually-hidden">
                            <a class="component-link btn-more" href="#"  title="{{i18n hbs.resultListing.moreButtonCopy}}">
                              <span class="icon-add"></span>
                              <span class="text-link">{{i18n hbs.resultListing.moreButtonCopy}}</span>
                            </a>
                         </div>
                      </div>
                   </div>
                </div>
             </div>
          </div>
       </div>
 </div>
</section>

<script type="text/javascript">
    (function() {
        var searchResultsModel = {
                queries: getUrlParams(decodeURIComponent(location.href)),
                CQModel: JSON.parse(document.getElementById('CQModel').getAttribute("data-cqmodal"))
            },
            requestUrls = {
                globalSearchParam: searchResultsModel.CQModel.globalSearchParam,
                localSearchParam: searchResultsModel.CQModel.localSearchParam,
                smartLogicURL: searchResultsModel.CQModel.smartLogicUrl
            },
            paramData = generateQuery(),
            reqWithOutFacets = paramData.concat('&facets=false');

        fetchResults(reqWithOutFacets);

        function fetchResults(data) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4) {
                    if(this.status == 200) {
                        //success
                        window.KPMG = window.KPMG || {};
                        window.KPMG.snpResults = JSON.parse(this.responseText);
                        window.KPMG.snpParams = {
                            url: paramData.split('/search')[1],
                            param: data
                        };

                        //To handle when S&P call is taking time
                        var event = new CustomEvent("snpResultsPrioritize");
                        document.dispatchEvent(event);
                    }
                }
            };
            xhttp.open("GET", data, true);
            xhttp.send();
        }

        function generateQuery() {
            var queryUrl = window.location.search ? "/search/"+window.location.search : searchResultsModel.CQModel.globalSearchUrl;
            var decodedUrl = decodeURIComponent(queryUrl);
            if (decodedUrl.indexOf('facets=true') > -1 || decodedUrl.indexOf('facets=false') > -1) {
                decodedUrl = decodedUrl.replace(/&?facets=(true|false)/gi, '');
            }
            return decodedUrl;
        }

        function getUrlParams(queryString) {
            var keyArrays = [];
            try {
                var queryComponents = queryString.indexOf("?") > -1 ? queryString.split("?"): "",
                    q = queryComponents[1] ? queryComponents[1].split("&") : "",
                    keyArrays = [];
                for(var i = 0; i<q.length ; i++) {
                    var  s = q[i].split("=");
                    keyArrays[s[0]] = decodeURI(s[1]);
                }

            } catch (err) {
            }
            return keyArrays;
        }
    })();
</script>
